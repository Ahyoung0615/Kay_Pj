<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd" >
<mapper namespace="com.min.edu.model.EmpInfoDaoImpl">

	<!-- 로그인 -->
	<select id="login" parameterType="java.util.Map" resultType="EmpInfoDto">
		SELECT ID, PASSWORD , NAME , ENABLE , AUTH 
		FROM EMPINFO e 
		WHERE ID = #{id} AND PASSWORD = #{password} AND ENABLE = 'Y'
	</select>
	
	<!-- 아이디 중복 검사 -->
	<select id="idCheck" parameterType="java.lang.String" resultType="EmpInfoDto">
		SELECT ID
		FROM EMPINFO e 
		WHERE ID = #{id}
	</select>
	
	<!-- 회원 가입 -->
	<insert id="singIn" parameterType="EmpInfoDto">
		INSERT INTO EMPINFO e (ID, PASSWORD, NAME, 
							PHONE, ENABLE, AUTH, FILENAME)
		VALUES (#{id}, #{password}, #{name}, #{phone, jdbcType=VARCHAR}, 'D', 'USER', #{filename, jdbcType=VARCHAR})
	</insert>
	
	<!-- 회원 가입 승인 -->
	<update id="memberSuccess" parameterType="java.util.List">
		UPDATE EMPINFO SET ENABLE = 'Y' WHERE ID IN 
		<foreach collection="list" item="id" open="(" separator="," close=")">
			#{id}
		</foreach>
	</update>
	
	<!-- 회원 삭제 -->
	<delete id="memberDel" parameterType="java.util.List">
		UPDATE EMPINFO SET ENABLE = 'N' WHERE ID IN
		<foreach collection="list" item="id" open="(" separator="," close=")">
			#{id}
		</foreach>
	</delete>
	
	<!-- 회원 목록 조회 -->
	<select id="selectMemberInfo" parameterType="java.util.Map" resultType="EmpInfoDto">
		SELECT ID, NAME , PHONE , 
				ENABLE , AUTH , FILENAME
		FROM (
			SELECT  ID, NAME , PHONE , 
					ENABLE , AUTH, FILENAME,
				   ROW_NUMBER() OVER(ORDER BY ENABLE DESC) RN
				FROM EMPINFO e )
		WHERE RN BETWEEN #{first} AND #{last}
	</select>
	
	<!-- 회원 전체 갯수 -->
	<select id="countMemberInfo" resultType="java.lang.Integer">
		SELECT COUNT(*) 
		FROM EMPINFO e 
	</select>
	
	<!-- 대기 회원 조회 -->
	<select id="waitingMember" parameterType="java.util.Map" resultType="EmpInfoDto">
		SELECT ID, NAME, PHONE, 
				ENABLE, AUTH, FILENAME
		FROM (
			SELECT ID, NAME, PHONE, 
					ENABLE, AUTH , FILENAME,
				   ROW_NUMBER() OVER(ORDER BY ID DESC) RN
				FROM EMPINFO e
				WHERE ENABLE = 'D')
		WHERE RN BETWEEN #{first} AND #{last}
	</select>
	
	<!-- 대기 회원 수 -->
	<select id="countWaiting" resultType="java.lang.Integer">
		SELECT COUNT(*) 
		FROM EMPINFO e2
		WHERE ENABLE  = 'D'
	</select>
</mapper>
